import{T as C,o as d,c as $,w as B,a as x,u as o,Z as S,b as t,f as l,n as m,t as r,g as y,i as R,z as q,p as w,F as k}from"./app-4cf649ca.js";import{_ as M}from"./GuestLayout-6a16832a.js";import{_ as U}from"./ValidationErrors-8e2a3487.js";import{_ as E}from"./Listbox-92b5110c.js";import{_ as I}from"./Alert-8ade166f.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ChevronUpDownIcon-0b91429b.js";import"./XMarkIcon-1e2e326f.js";import"./hidden-253ee999.js";import"./CheckIcon-20c25c5e.js";const K=t("div",{class:"mb-4 text-sm text-gray-600"}," This is a secure area of the application. Only admin can view this page. ",-1),L={class:"mb-4 text-sm"},P={key:0},Q={class:"py-1 whitespace-nowrap font-bold text-base text-left"},Z={class:"sm:flex sm:items-start mt-5"},G={class:"text-lg font-medium leading-6 text-gray-900"},H={key:1,class:"mt-5 grid grid-cols-2 gap-1 text-xs"},J={class:"py-1 whitespace-nowrap sm:text-sm text-stone-500 text-left"},W={class:"py-1 whitespace-nowrap sm:text-sm text-stone-500 text-left"},X=["placeholder"],Y={class:"sm:flex sm:items-start mt-5"},tt={class:"w-full"},et={class:"text-sm font-medium text-gray-500"},st={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},ot={class:"capitalize"},at={class:"bg-white px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},rt=t("dt",{class:"text-sm font-medium text-gray-500"}," Sub Total ",-1),nt={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},it={class:"capitalize"},ct={class:"bg-gray-50 px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},dt=t("dt",{class:"text-sm font-medium text-gray-500"}," Discount ",-1),lt={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},mt={class:"capitalize"},ut={class:"bg-white px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},pt=t("dt",{class:"text-sm font-medium text-gray-500"}," VAT ",-1),_t={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},gt={class:"capitalize"},xt={class:"bg-gray-50 px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4']"},bt=t("dt",{class:"text-sm font-medium text-gray-500"}," Discount ",-1),ht={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2"},yt={class:"capitalize"},ft={class:"sm:flex sm:items-start mt-5"},vt={class:"text-lg font-medium leading-6 text-gray-900"},wt={class:"sm:flex sm:items-start mt-5"},kt={class:"border-collapse table-auto w-full text-sm"},jt=t("thead",null,[t("tr",null,[t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-left"},"Product"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Rate"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Qty"),t("th",{class:"px-3 py-2 border-b bg-gray-100 text-xs font-bold uppercase tracking-wider text-right"},"Total")])],-1),At={class:"bg-white"},Ot={class:"px-3 py-2 whitespace-wrap text-left"},Nt={class:"px-3 py-2 whitespace-wrap text-right"},Ft={class:"px-3 py-2 whitespace-wrap text-center"},Vt={class:"px-3 py-2 whitespace-wrap text-right"},zt={key:2,class:"mt-5 sm:mt-4 sm:flex sm:justify-between"},Dt=["disabled"],Tt=["disabled"],Kt={__name:"Approval",props:{app:Object,string_change:Object,setting:Object,errors:Object,branch:Object,order:Object,discount_types:Array,status:String,token:String},setup(i){const a=i,e=C({order_id:a.order.id,sub_total:a.order.sub_total,discount_type:a.order.discount_type,discount_rate:a.order.discount_rate,discount_amount:a.order.discount_amount,vat_rate:a.order.vat_rate??5,vat_amount:a.order.vat_amount,total:a.order.total,status:"",token:a.token});e.group_items=a.order.products??[],e.total_text=e.sub_total+" - "+e.discount_amount+" + "+e.vat_amount+" = "+e.total;const j=[{name:"Date",value:a.order.date},{name:"Customer",value:a.order.customer_name},{name:"Manager",value:a.order.creator_name},{name:"Served By",value:a.order.waiter_name}],A=()=>{let u=Number(e.discount_rate),c=Number(e.vat_rate),s=e.group_items;console.log(s);let n=s.reduce((p,_)=>p+Number(_.rate)*Number(_.quantity),0)??0,h=s.filter(p=>!p.vat_applicable).reduce((p,_)=>p+Number(_.rate)*Number(_.quantity),0)??0,F=u/100,g=b(e.discount_type=="percent"?n*F:u),V=b(h>0?h/n*g:0),z=h-V,f=n-g-z,D=c/100,v=b(f*D),T=n-g+v;e.sub_total=n.toFixed(2),e.discount_amount=g.toFixed(2),e.vatable_amount=f.toFixed(2),e.vat_amount=v,e.total=T.toFixed(2),e.total_text=e.sub_total+" - "+e.discount_amount+" + "+e.vat_amount+" = "+e.total},b=u=>Math.round(u),O=()=>{confirm("Are you sure you want to Approve?")&&(e.status="approved",e.post(route("order.approval.update"),{onFinish:()=>e.reset()}))},N=()=>{confirm("Are you sure you want to Reject?")&&(e.status="rejected",e.post(route("order.approval.update"),{onFinish:()=>e.reset()}))};return(u,c)=>(d(),$(M,null,{default:B(()=>[x(o(S),{title:"Order Approval"}),K,t("div",L,[x(U,{class:"mb-4"}),x(I),i.status!="pending"?(d(),l("div",P,[t("div",Q,[t("p",{class:m([i.status=="approved"?"bg-green-500":"bg-red-500","py-2 px-3 text-white"])},"This order is "+r(i.status),3)])])):y("",!0),t("div",Z,[t("h3",G," # Order need Approval ("+r(i.branch.name)+") ",1)]),i.status=="pending"?(d(),l("div",H,[t("div",J,[x(E,{class:"w-full",modelValue:o(e).discount_type,"onUpdate:modelValue":c[0]||(c[0]=s=>o(e).discount_type=s),items:i.discount_types,hideIcon:!0},null,8,["modelValue","items"])]),t("div",W,[R(t("input",{"onUpdate:modelValue":c[1]||(c[1]=s=>o(e).discount_rate=s),onKeyup:c[2]||(c[2]=s=>A()),placeholder:[o(e).discount_type=="percent"?"Discount Rate in %":"Discount in amount"],type:"text",oninput:"this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\\..*?)\\..*/g, '$1');",autocomplete:"off",class:m(["block w-full px-4 text-left text-xs sm:text-sm border-stone-300 focus:ring-primary-400 focus:border-primary-400 hover:bg-stone-100 focus:bg-transparent rounded"])},null,40,X),[[q,o(e).discount_rate]])])])):y("",!0),t("div",Y,[t("dl",tt,[(d(),l(k,null,w(j,(s,n)=>t("div",{key:n,class:m([n%2==1?"bg-white":"bg-gray-50","px-0 py-2 sm:grid sm:grid-cols-3 sm:gap-4"])},[t("dt",et,r(s.name),1),t("dd",st,[t("span",ot,r(s.value),1)])],2)),64)),t("div",at,[rt,t("dd",nt,[t("span",it,r(o(e).sub_total),1)])]),t("div",ct,[dt,t("dd",lt,[t("span",mt,r(o(e).discount_amount),1)])]),t("div",ut,[pt,t("dd",_t,[t("span",gt,r(o(e).vat_amount),1)])]),t("div",xt,[bt,t("dd",ht,[t("span",yt,r(o(e).total_text),1)])])])]),t("div",ft,[t("h3",vt," # Order "+r(i.string_change.product_s),1)]),t("div",wt,[t("table",kt,[jt,t("tbody",At,[(d(!0),l(k,null,w(o(e).group_items,(s,n)=>(d(),l("tr",{key:n,class:m([n%2==0?"bg-white":"bg-gray-50","border-b border-gray-100 pl-0 p-3 text-gray-900"])},[t("td",Ot,r(s.product_name),1),t("td",Nt,r(s.rate),1),t("td",Ft,r(s.quantity),1),t("td",Vt,r(s.total),1)],2))),128))])])]),i.status=="pending"?(d(),l("div",zt,[t("button",{type:"button",onClick:O,disabled:o(e).processing,class:m({"opacity-25":o(e).processing,"inline-flex w-full uppercase justify-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 sm:w-auto sm:text-sm":!0})},"Approve",10,Dt),t("button",{type:"button",onClick:N,disabled:o(e).processing,class:m({"opacity-25":o(e).processing,"mt-3 inline-flex w-full uppercase justify-center rounded-md border border-gray-300 bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm":!0})},"Reject",10,Tt)])):y("",!0)])]),_:1}))}};export{Kt as default};
